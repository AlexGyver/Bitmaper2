(()=>{"use strict";class t{static context;constructor(e,n={},i=!1){t.context=this,this.$root=t.make(e,n,i)}static make(e,n={},i=!1){return e&&"object"==typeof n?n instanceof Node?n:("svg"==e&&(i=!0),t.config(i?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e),n,i)):null}static makeIn(e,n,i={},r=!1){return i.context=e,t.make(n,i,r)}static config(e,n,i=!1){if(Array.isArray(e))return e.forEach(e=>t.config(e,n,i)),null;if(!(e instanceof Node)||"object"!=typeof n)return e;let r=n.context;t.context=null===r?null:r||t.context,r=t.context;let a=n=>{if(n)if(n instanceof Node)e.appendChild(n);else if(n instanceof t)e.appendChild(n.$root);else if("string"==typeof n)e.innerHTML+=n;else if("object"==typeof n){let r=t.make(n.tag??"div",n,i||"svg"==n.tag);r&&e.appendChild(r)}};for(const[i,s]of Object.entries(n)){switch(i){case"text":e.textContent=null==s?"":s+"";continue;case"html":e.innerHTML=null==s?"":s+"";continue;case"tag":case"context":case"get":case"also":continue}if(s)switch(i){case"class":(Array.isArray(s)?s:s.split(" ")).map(t=>t&&e.classList.add(t));break;case"push":s.push(e);break;case"$":case"var":r&&(r["$"+s]=e);break;case"events":for(let t in s)e.addEventListener(t,r?s[t].bind(r):s[t]);break;case"click":case"change":case"input":case"mousewheel":e.addEventListener(i,r?s.bind(r):s);break;case"parent":s.appendChild(e);break;case"attrs":for(let t in s)e.setAttribute(t,s[t]);break;case"props":for(let t in s)e[t]=s[t];break;case"child_r":t.clear(e);case"child":a(s);break;case"children_r":t.clear(e);case"children":for(let t of s)a(t);break;case"style_r":e.style.cssText="";case"style":if("string"==typeof s)e.style.cssText+=s+";";else for(let t in s)s[t]&&(e.style[t]=s[t]);break;default:e[i]=s}}return n.also&&r&&n.also.call(r,e),e}static configIn(e,n,i,r=!1){return i.context=e,t.config(n,i,r)}static clear(t){for(;t.firstChild;)t.removeChild(t.lastChild)}static makeArray(e,n=!1){return e&&Array.isArray(e)?e.map(e=>t.make(e.tag,e,n)):[]}static makeShadow(e,n={},i=null){if(!e||"object"!=typeof n)return null;let r=e instanceof Node?e:document.createElement(e);return r.attachShadow({mode:"open"}),t.config(r.shadowRoot,{context:n.context,children:[{tag:"style",textContent:i??""},n.child??{},...n.children??[]]}),delete n.children,delete n.child,t.config(r,n),r}}new Set,new Map;const e=(t,e,n)=>t<e?e:t>n?n:t,n=t=>Math.round(t)|0,i=t=>navigator.clipboard.writeText(t),r=t=>(new TextEncoder).encode(t),a=t=>(new TextDecoder).decode(t);const s=t=>"#"+Number(t).toString(16).padStart(6,"0"),o=(t,e,n)=>t<<16|e<<8|n,l=t=>[t>>16&255,t>>8&255,255&t,t>>24&255];function c(t,e){let n=document.createElement("a");n.href=window.URL.createObjectURL(t),n.download=e,n.click()}async function h(t,e={}){let n,i,r=null;e.timeout&&(n=new AbortController,i=setTimeout(()=>n.abort(),e.timeout),e.signal=n.signal);try{r=await fetch(t,e)}catch(t){}return clearTimeout(i),r&&r.ok?r:null}class d{static has(t){return localStorage.hasOwnProperty(t)}static get(t){return JSON.parse(localStorage.getItem(t))}static remove(t){localStorage.removeItem(t)}static set(t,e){try{localStorage.setItem(t,JSON.stringify(e))}catch(t){console.error(t)}}static init(t,e){d.has(t)||d.set(t,e)}}class u{_data;constructor(t){this._data=t}get label(){return this._data.$label.innerText}set label(t){return this._data.$label.innerText=t+""}get value(){return this._data.$control.value}set value(t){return this._data.$control.value=t+""}get input(){return this._data.$control}display(t){this._data.$container.style.display=t?"block":"none"}show(){this.display(1)}hide(){this.display(0)}remove(){this._data.$container.remove()}default(){this.value=this._data.default+"",this._data.$output&&(this._data.$output.innerText=this._data.default+"")}}class p extends u{constructor(t){super(t)}set value(t){return this._data.$output&&(this._data.$output.innerText=t+""),this._data.$control.value=t+""}get value(){return Number(this._data.$control.value)}}class g extends p{constructor(t){super(t)}set value(t){return super.value=t}get value(){return this._data.$control.value}set valueInt(t){return"#"+t.toString(16).padStart(6,0)}get valueInt(){return parseInt(this.value.slice(1),16)}}class f extends u{constructor(t){super(t)}get value(){return this._data.$control.checked?1:0}set value(t){return this._data.$control.checked=t}default(){this.value=this._data.default}}class m extends u{constructor(t){super(t)}get value(){return this._data.$control.innerHTML}set value(t){return this._data.$control.innerHTML=t+""}}class b extends u{constructor(t){super(t)}get value(){return this._data.$control.files[0]}set value(t){}}class x extends u{constructor(t){super(t)}set value(t){}get value(){return 1}}class v extends p{constructor(t){super(t)}set options(e){return this._data.$control.replaceChildren(...e.map((e,n)=>t.make("option",{text:e,value:n+""})))}get options(){return Array.from(this._data.$control.options).map(t=>t.text)}get text(){return this.options[this.value]}}class y extends u{constructor(t){super(t)}set value(t){this._data.$control.innerText=t+""}get value(){return this._data.$control.innerText}}class _{constructor(e={}){_.css=function(t){if(t){let e=document.createElement("style");e.innerText=t,document.head.appendChild(e)}return null}(_.css);let n={};return null===(e={...{x:null,y:null,width:"200px",parent:document.body,title:"",zIndex:3,theme:"light",autoVar:!0,class:""},...e}).x&&null===e.y||(n.left=e.x+"px",n.top=e.y+"px",n.position="absolute"),this.autoVar=e.autoVar,this.class=e.class,t.makeIn(this,"div",{style:{zIndex:e.zIndex,width:"string"==typeof e.width?e.width:e.width+"px",...n},parent:e.parent,children:[{class:"ui_title_bar",text:e.title,$:"title"},{class:"ui_content",$:"content"}],$:"root"}),this.setTheme(e.theme)}setTheme(t){return this.$root.classList=`ui_main theme-${t} ${this.class}`,this}destroy(){this.removeAll(),this.$root&&(this.$root.remove(),this.$root=void 0,this.#t=new Map)}setLabels(t){for(let e in t)this.#t.has(e)&&(this.#t.get(e).label=t[e])}toObject(){let t={};return this.#t.forEach((e,n)=>{e instanceof x||(t[n]=e.value)}),t}toJson(){return JSON.stringify(this.toObject())}fromObject(t){for(let e in t)this.#t.has(e)&&(this.#t.get(e).value=t[e])}fromJson(t){this.fromObject(JSON.parse(t))}getWidget(t){return this.#t.get(t)}control(t){return this.#t.get(t)}get(t){return this.#t.has(t)?this.#t.get(t).value:void 0}set(t,e){return this.#t.has(t)&&(this.#t.get(t).value=e),e}remove(t){"string"==typeof t&&(t=[t]);for(let e of t)this.#t.has(e)&&(this.#t.get(e).remove(),this.#t.delete(e),Object.defineProperty(this,e,{get:void 0,set:void 0}),Object.defineProperty(this,e+"Text",{get:void 0}))}removeAll(){this.remove(Array.from(this.#t.keys())),function(t){for(;t.firstChild;)t.removeChild(t.lastChild)}(this.$content)}onChange(t){this.#e=t}addSwitch(e,n,i,r){if(this.#t.has(e))return this;let a={default:i=i?1:0};return t.makeIn(a,"div",{$:"container",class:"ui_container",parent:this.$content,child:{tag:"label",class:"ui_checkbox_cont",children:[{tag:"label",text:n,$:"label"},{tag:"div",class:"ui_checkbox",child:{tag:"label",children:[{tag:"input",type:"checkbox",checked:i,$:"control",change:t=>{let n=t.target.checked?1:0;this.#e(e,n),r&&r(n)}},{tag:"span"}]}}]}}),e&&this.#t.set(e,new f(a)),this._addSetGet(e),this}addNumber(e,n,i,r,a){if(this.#t.has(e))return this;i=i??0;let s=this._makeContainer(n);return s.default=i,t.makeIn(s,"input",{parent:s.$container,type:"number",class:"ui_input",step:(r??1)+"",value:i+"",$:"control",input:t=>{let n=Number(t.target.value);this.#e(e,n),a&&a(n)},mousewheel:()=>{}}),e&&this.#t.set(e,new p(s)),this._addSetGet(e),this}addInput(t,e,n,i){return this.addText(t,e,n,i)}addText(e,n,i,r){if(this.#t.has(e))return this;i=i??"";let a=this._makeContainer(n);return a.default=i,t.makeIn(a,"input",{parent:a.$container,type:"text",class:"ui_input",value:i+"",$:"control",input:t=>{let n=t.target.value;this.#e(e,n),r&&r(n)}}),e&&this.#t.set(e,new u(a)),this._addSetGet(e),this}addRange(...t){return this.addSlider(...t)}addSlider(e,n,i,r,a,s,o){if(this.#t.has(e))return this;i=i??0;let l=this._makeContainerOut(n,i);return l.default=i,t.makeIn(l,"div",{parent:l.$container,class:"ui_range_cont",child:{tag:"input",type:"range",class:"ui_range",min:(r??0)+"",max:(a??100)+"",step:(s??1)+"",value:i+"",$:"control",input:t=>{let n=Number(t.target.value);this.#e(e,n),o&&o(n),l.$output.innerText=n},mousewheel:t=>{t.stopPropagation(),t.preventDefault();let e=t.target;e.value=Number(e.value)+Number(e.step)*(t.deltaY>0?-1:1),e.dispatchEvent(new Event("input"))}}}),e&&this.#t.set(e,new p(l)),this._addSetGet(e),this}addArea(e,n,i,r,a=5){if(this.#t.has(e))return this;i=i??"";let s=this._makeContainer(n);return s.default=i,t.makeIn(s,"textarea",{parent:s.$container,class:"ui_textarea",rows:a,value:i+"",$:"control",input:t=>{let n=t.target.value;this.#e(e,n),r&&r(n)}}),e&&this.#t.set(e,new u(s)),this._addSetGet(e),this}addHTML(e,n,i){if(this.#t.has(e))return this;i=i??"";let r=this._makeContainer(n);return r.default=i,t.makeIn(r,"div",{parent:r.$container,html:i+"",$:"control"}),e&&this.#t.set(e,new m(r)),this._addSetGet(e),this}addElement(t,e,n){if(this.#t.has(t))return this;let i=this._makeContainer(e);return i.default=n,i.$control=n,i.$container.append(n),t&&this.#t.set(t,new m(i)),this._addSetGet(t),this}addSelect(e,n,i,r){if(this.#t.has(e))return this;i=i??[];let a=this._makeContainer(n);return a.default=0,t.makeIn(a,"select",{parent:a.$container,class:"ui_select",$:"control",change:t=>{let n=t.target.selectedIndex,i=t.target.options[n].text;this.#e(e,n,i),r&&r(n,i)},mousewheel:t=>{t.stopPropagation(),t.preventDefault();let e=t.target;if(t.deltaY<0&&e.selectedIndex>0)e.selectedIndex--;else{if(!(t.deltaY>0&&e.selectedIndex<e.options.length-1))return;e.selectedIndex++}e.dispatchEvent(new Event("change"))},children:i.map((e,n)=>t.make("option",{text:e,value:n+""}))}),e&&this.#t.set(e,new v(a)),this._addSetGet(e)&&Object.defineProperty(this,e+"Text",{get:()=>this.getWidget(e).text,configurable:!0}),this}addButton(e,n,i){if(this.#t.has(e))return this;let r={};return t.makeIn(r,"div",{$:"container",class:"ui_button_cont",parent:this.$content,children:[this._makeButton(r,e,n,i)]}),r.$label=r.$control,e&&this.#t.set(e,new x(r)),this}addButtons(e){let n=t.make("div",{class:"ui_button_cont",parent:this.$content});for(let t in e){let i={$container:n},r=e[t];n.append(Array.isArray(r)?this._makeButton(i,t,r[0],r[1]):this._makeButton(i,t,r)),i.$label=i.$control,t&&this.#t.set(t,new x(i))}return this}addFile(e,n,i){if(this.#t.has(e))return this;let r=this._makeContainer(n),a=t=>{let n="";for(let e=0;e<t.length;e++)n+=(e?", ":"")+t[e].name;if(r.$filename.innerText=n.length?n:"...",!t.length)return;let a=1==t.length?t[0]:t;this.#e(e,a),i&&i(a)};return t.makeIn(r,"input",{parent:r.$container,class:"ui_file_chooser",type:"file",$:"control",change:()=>a(r.$control.files),attrs:{multiple:!0}}),t.makeIn(r,"label",{parent:r.$container,class:"ui_file_chooser_label",text:"...",$:"filename"}),t.config(r.$container,{events:{click:()=>r.$control.click(),drop:t=>a(t.dataTransfer.files)}}),e&&this.#t.set(e,new b(r)),["dragenter","dragover","dragleave","drop"].forEach(t=>{this.$root.addEventListener(t,t=>{t.preventDefault(),t.stopPropagation()},!1)}),["dragenter","dragover"].forEach(t=>{this.$root.addEventListener(t,function(){r.$filename.classList.add("active")},!1)}),["dragleave","drop"].forEach(t=>{this.$root.addEventListener(t,function(){r.$filename.classList.remove("active")},!1)}),this._addSetGet(e),this}addColor(e,n,i,r){if(this.#t.has(e))return this;i=i??"#000";let a=this._makeContainerOut(n,i);return a.default=i,t.configIn(a,a.$container,{class:"ui_color_cont",child:{tag:"input",type:"color",class:"ui_color",value:i,$:"control",attrs:{"colorpick-eyedropper-active":!1},input:t=>{let n=t.target.value;this.#e(e,n),r&&r(n),a.$output.innerText=n}}}),e&&this.#t.set(e,new g(a)),this._addSetGet(e),this}addLabel(t,e,n){if(this.#t.has(t))return this;n=n??"";let i=this._makeContainerOut(e,n);return i.$control=i.$output,t&&this.#t.set(t,new y(i)),this._addSetGet(t),this}addSpace(e=5){return t.make("div",{style:`height: ${e}px`,parent:this.$content}),this}_addSetGet(t){return!(!this.autoVar||!t||"function"==typeof this[t])&&(Object.defineProperty(this,t,{get:()=>this.get(t),set:e=>this.set(t,e),configurable:!0}),!0)}_checkID(t){return t||"_empty_"+this.#n++}_makeButton(e,n,i,r){return t.makeIn(e,"button",{class:"ui_button",$:"control",text:i+"",click:t=>{this.#e(n),r&&r()}})}_makeContainer(e){let n={};return t.makeIn(n,"div",{$:"container",class:"ui_container",parent:this.$content,children:[{class:"ui_label",children:[{tag:"b",$:"label",text:e}]}]}),n}_makeContainerOut(e,n){let i={};return t.makeIn(i,"div",{$:"container",class:"ui_container",parent:this.$content,children:[{class:"ui_label",children:[{tag:"b",text:e,$:"label"},{tag:"span",text:": "},{tag:"span",text:n+"",$:"output"}]}]}),i}#t=new Map;#n=0;#e=()=>{};static css='.ui_main.theme-light{--border:#aaa;--back:#fff;--mid:#ccc;--tab:#f0f0f0;--font:#000;--font-mid:#555;--thumb:var(--back)}.ui_main.theme-dark{--border:#484d53;--back:rgb(30, 35, 42);--mid:#22272E;--tab:#2D333B;--font:#ccc;--font-mid:#999;--thumb:var(--font-mid)}.ui_main{background-color:var(--mid);text-align:left;font:12px sans-serif;user-select:none;border:none;border-radius:6px}.ui_main.noback{background:none}.ui_main.noback .ui_container{border:1px solid var(--mid);margin:5px 0}.ui_main.noback .ui_title_bar{display:none}.ui_main.noback .ui_button_cont{margin:5px 0}.ui_main.noback .ui_button{border:1px solid var(--mid)}.ui_content{overflow-y:auto;border-radius:6px}.ui_title_bar{text-align:center;font-weight:700;border:none;background:var(--tab);color:var(--font);font-size:15px;border-radius:5px 5px 0 0}.ui_title_bar:not(:empty){padding:4px}.ui_container{margin:5px;padding:5px;border:none;position:relative;background:var(--tab);color:var(--font);border-radius:5px}.ui_range_cont{display:flex;align-items:center;padding:8px 0 6px 0}.ui_range{appearance:none;box-sizing:border-box;margin:0;padding:0;width:100%;height:2px;background:var(--border);cursor:pointer;touch-action:none}.ui_range::-webkit-slider-thumb{appearance:none;background:var(--thumb);width:16px;height:16px;border-radius:50%;box-shadow:0 0 4px #0000005a}.ui_range::-moz-range-thumb{border:none;background:var(--thumb);width:16px;height:16px;border-radius:50%}.ui_button_cont{margin:5px;gap:5px;display:flex}.ui_button{cursor:pointer;background:var(--tab);color:var(--font-mid);height:26px;border-radius:4px;width:100%;border:none}.ui_button:hover{filter:brightness(.96)}.ui_button:active{background:var(--back)}.ui_checkbox_cont{cursor:pointer;display:flex;align-items:center;justify-content:space-between}.ui_checkbox_cont label{font-weight:700;pointer-events:none}.ui_checkbox{display:inline-block}.ui_checkbox label{display:flex;align-items:center;cursor:pointer;user-select:none}.ui_checkbox input{display:none}.ui_checkbox span{width:18px;height:18px;border:1px solid var(--border);border-radius:4px;background-color:var(--back);position:relative}.ui_checkbox input:checked+span::after{content:"✓";position:absolute;left:3px;top:-2px;font-size:16px;color:var(--font);font-weight:700}.ui_label{margin-bottom:3px;user-select:none;-webkit-user-select:none;cursor:default}.ui_input{box-sizing:border-box;width:100%;padding:5px;height:24px;line-height:24px;border:1px solid var(--border);background:var(--back);color:var(--font-mid);border-radius:4px}.ui_select{background:var(--back);color:var(--font-mid);width:100%;height:24px;border:1px solid var(--border);border-radius:0;padding:0 2px;cursor:pointer;border-radius:4px}.ui_textarea{box-sizing:border-box;resize:vertical;width:100%;padding:3px 5px;border:1px solid var(--border);background:var(--back);color:var(--font-mid);border-radius:4px}.ui_textarea::-webkit-scrollbar{width:7px;height:7px}.ui_textarea::-webkit-scrollbar-track{background:none}.ui_textarea::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px}.ui_color_cont{display:flex;align-items:center;justify-content:space-between}.ui_color_cont .ui_label{margin:0}.ui_color{cursor:pointer;padding:0;margin:0;border:none;background:none;height:22px;width:22px}.ui_file_chooser{display:none}.ui_file_chooser_label{background:var(--back);color:var(--font-mid);height:24px;border:1px solid var(--border);width:100%;display:block;cursor:pointer;padding:5px;box-sizing:border-box;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;border-radius:4px}.ui_file_chooser_label.active{border-width:2px}'}class w{resize(t,e){this.W=t,this.H=e,this.buf=new Int32Array(t*e)}set(t,e,n){this.buf[e*this.W+t]=n}get(t,e){return this.buf[e*this.W+t]}fill(t){this.buf.fill(t)}clear(){this.fill(0)}copy(){let t=new w;return t.W=this.W,t.H=this.H,t.buf=new Int32Array(this.buf),t}}function $(t,e,n=window,i=300,r=5){let a=(...t)=>n.document.addEventListener(...t),s=(...t)=>n.document.removeEventListener(...t);const o="ontouchstart"in n.document.documentElement;let l=0,c=[],h=null,d={x:0,y:0},u={x:0,y:0},p=!1,g=(n,i)=>{e({type:n,touch:o,width:t.clientWidth,height:t.clientHeight,move:{x:0,y:0},pos:{x:0,y:0},drag:d,pressed:o?c.length>=2:l,...i})},f=(e,i)=>({x:Math.round(e-t.getBoundingClientRect().left),y:Math.round(i-t.getBoundingClientRect().top-n.document.documentElement.scrollTop)}),m=t=>f(t.pageX,t.pageY),b=()=>{d={x:0,y:0},u={x:0,y:0},h&&clearTimeout(h),h=setTimeout(()=>h=null,i)},x=()=>{h&&(clearTimeout(h),h=null)},v=()=>{let t=0;return h&&(x(),t=Math.abs(d.x)<r&&Math.abs(d.y)<r),d={x:0,y:0},u={x:0,y:0},t};if(o){let e=(t,e)=>{for(let i in t.changedTouches)if(t.changedTouches[i].identifier==e)return n(t,i);return null},n=(t,e)=>{let n=t.changedTouches[e];return{id:n.identifier,x:n.pageX,y:n.pageY}},i=e=>{p&&e.target!=t&&!c.length&&(p=!1,g("leave"),s("touchstart",i),s("touchmove",r),s("touchend",o),s("touchcancel ",o))},r=t=>{if(c.length){if(1==c.length){let n=c[0],i=e(t,n.id);if(!i)return;t.preventDefault();let r=i.x-n.x,a=i.y-n.y;u.x+=r,u.y+=a,g("move",{move:{x:r,y:a},pos:f(i.x,i.y)}),g("tdrag",{move:{x:r,y:a},drag:u,pos:f(i.x,i.y)}),x()}else{let n=[0,0],i=[0,0],r=0;for(let a in n)i[a]=c[a],n[a]=e(t,i[a].id),n[a]?r=1:n[a]=i[a];if(r){t.preventDefault();let e=(n[0].x+n[1].x)/2,r=(n[0].y+n[1].y)/2,a=e-(i[0].x+i[1].x)/2,s=r-(i[0].y+i[1].y)/2;d.x+=a,d.y+=s,g("drag",{move:{x:a,y:s},pos:f(e,r)});let o=Math.abs(n[0].x-n[1].x),l=Math.abs(n[0].y-n[1].y),c=Math.abs(i[0].x-i[1].x),h=Math.abs(i[0].y-i[1].y);g("zoom",{zoom:Math.hypot(o,l)-Math.hypot(c,h),pos:f(e,r)})}}for(let n in c){let i=e(t,c[n].id);i&&(c[n]=i)}}},o=t=>{if(c.length){let e=n(t,0);if(!e)return;let i=c.findIndex(t=>e.id==t.id);~i&&(t.preventDefault(),c.splice(i,1),c.length||(g("trelease",{pos:f(e.x,e.y)}),v()&&g("click",{pos:f(e.x,e.y)})),1==c.length&&g("release",{pos:f(e.x,e.y)}))}};t.addEventListener("touchstart",t=>{t.preventDefault();let e=n(t,0);if(!e)return;let s=c.findIndex(t=>e.id==t.id);~s&&c.splice(s,1),c.unshift(e),1==c.length&&(b(),p||(p=!0,a("touchstart",i,{passive:!1}),a("touchmove",r,{passive:!1}),a("touchend",o),a("touchcancel ",o),g("enter",{pos:f(e.x,e.y)})),g("tpress",{pos:f(e.x,e.y)})),2==c.length&&(g("press",{pos:f(e.x,e.y)}),x())},{passive:!1})}else{let e=()=>{s("mousemove",i),s("mouseup",r)},n=()=>{a("mousemove",i),a("mouseup",r)},i=t=>{l&&(t.preventDefault(),d.x+=t.movementX,d.y+=t.movementY,g("drag",{move:{x:t.movementX,y:t.movementY},pos:m(t)}))},r=n=>{l&&(n.preventDefault(),l=0,g("release",{pos:m(n)}),v()&&g("click",{pos:m(n)}),n.target!==t&&e())};t.addEventListener("mouseenter",t=>{g("enter",{pos:m(t)}),n()}),t.addEventListener("mouseleave",t=>{g("leave",{pos:m(t)}),l||e()}),t.addEventListener("mousedown",t=>{l||(n(),t.preventDefault(),l=1,b(),g("press",{pos:m(t)}))}),t.addEventListener("mousemove",t=>{l||g("move",{move:{x:t.movementX,y:t.movementY},pos:m(t)})}),t.addEventListener("wheel",t=>{t.preventDefault(),g("zoom",{zoom:-t.deltaY/100,pos:m(t)})},{passive:!1})}}const k=(t,e,n)=>Math.round(.299*t+.587*e+.114*n);function S(t){for(let e=0;e<t.length;e++)t[e]=255-t[e];return t}function B(t,e){for(let n=0;n<t.length;n++)t[n]=t[n]<e?0:255;return t}class I{constructor(t,e){this.onpan=e,this.cv=t,this.cx=this.cv.getContext("2d",{willReadFrequently:!0}),new $(t,t=>{if(!this.img)return;let e=this.cv.width/this.cv.clientWidth;switch(t.type){case"zoom":this.offset.w+=t.touch?t.zoom:this.offset.w/10*Math.sign(t.zoom),this.offset.w<0&&(this.offset.w=0),this.show(),this.onpan();break;case"drag":case"tdrag":this.offset.x-=t.move.x*e,this.offset.y-=t.move.y*e,this.show(),this.onpan()}})}setImage(t,e){this.img=t,e&&(this.offset=null)}fit(){this.img&&(this.offset={x:0,y:0,w:this.img.width*Math.min(this.cv.width/this.img.width,this.cv.height/this.img.height)},this.onpan())}setFilter(t){this.fil=t}show(){let t=this.fil,i=this.cx;if(i.fillStyle=this.fil.bblack?"black":"white",i.fillRect(0,0,this.cv.width,this.cv.height),!this.img)return;this.offset||this.fit(),i.save(),i.translate(this.cv.width/2-this.offset.x,this.cv.height/2-this.offset.y),i.rotate(-.0174532925*this.fil.angle);let r=this.offset.w/this.img.width;i.scale(r,r),this.cx.filter=`brightness(${t.brightness??0}%) contrast(${t.contrast??0}%) saturate(${t.saturate??0}%) blur(${(t.blur??0)*Math.sqrt(this.cv.width**2+this.cv.height**2)/64}px)`,i.drawImage(this.img,-this.img.width/2,-this.img.height/2),i.restore();let a=i.getImageData(0,0,this.cv.width,this.cv.height),s=a.data;if(t.mask){let e=t.mask_tol,n=t.mask_amp,i=l((t=>{let e=t=>parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16),n=t=>parseInt(t.slice(1,7),16);if(t&&"#"==t[0])switch(t.length){case 4:return e(t);case 5:return e(t)|parseInt(t[4]+t[4],16)<<24;case 7:return n(t);case 9:return n(t)|parseInt(t.slice(7,9),16)<<24}return 0})(t.mask_color));for(let t=0,r=0;t<s.length;t+=4,r++)if(s[t+3]){let r=Math.sqrt((s[t+0]-i[0])**2+(s[t+1]-i[1])**2+(s[t+2]-i[2])**2);s[t+0]=s[t+1]=s[t+2]=r<e?r/n:255}}if(t.gray){let i=new w;i.resize(this.cv.width,this.cv.height);for(let t=0,e=0;t<s.length;t+=4,e++)s[t+3]&&(i.buf[e]=k(s[t+0],s[t+1],s[t+2]));switch(t.edges&&function(t,i,r){const a=[[-1,-1,-1],[-1,9,-1],[-1,-1,-1]];let s=[...t];for(let o=1;o<i-1;o++)for(let l=1;l<r-1;l++){let r=0;for(let t=-1;t<=1;t++)for(let e=-1;e<=1;e++){let n=s[o+t+(l+e)*i];r+=a[e+1][t+1]*n}t[o+l*i]=n(e(r,0,255))}}(i.buf,i.W,i.H),t.sobel&&function(t,i,r,a){const s=[[-1,0,1],[-2,0,2],[-1,0,1]],o=[[-1,-2,-1],[0,0,0],[1,2,1]];let l=[...t];for(let n=0;n<i;n++)for(let a=0;a<r;a++){let c=0,h=0;if(0!=n&&n!=i-1&&0!=a&&a!=r-1)for(let e=-1;e<=1;e++)for(let r=-1;r<=1;r++){let l=t[n+e+(a+r)*i];c+=s[r+1][e+1]*l,h+=o[r+1][e+1]*l}let d=Math.sqrt(c**2+h**2);l[n+a*i]=e(d,0,255)}for(let e=0;e<t.length;e++){let i=t[e]*(1-a)+(255-l[e])*a;t[e]=n(i)}}(i.buf,i.W,i.H,t.sobel),t.dither){case 1:!function(t,e,n){for(let i=0;i<n;i++)for(let r=0;r<e;r++){let a=i*e+r,s=t[a],o=s<128?0:255,l=s-o;t[a]=o,r+1<e&&(t[a+1]+=Math.floor(7*l/16)),i+1<n&&(r>0&&(t[a+e-1]+=Math.floor(3*l/16)),t[a+e]+=Math.floor(5*l/16),r+1<e&&(t[a+e+1]+=Math.floor(l/16)))}for(let e=0;e<t.length;e++)t[e]=t[e]<0?0:t[e]>255?255:t[e]}(i.buf,i.W,i.H);break;case 2:!function(t,n,i){const r=[{x:1,y:0,w:7},{x:2,y:0,w:5},{x:-2,y:1,w:3},{x:-1,y:1,w:5},{x:0,y:1,w:7},{x:1,y:1,w:5},{x:2,y:1,w:3},{x:-2,y:2,w:1},{x:-1,y:2,w:3},{x:0,y:2,w:5},{x:1,y:2,w:3},{x:2,y:2,w:1}];for(let a=0;a<i;a++)for(let s=0;s<n;s++){const o=a*n+s,l=t[o],c=l<128?0:255;t[o]=c;const h=l-c;for(let o=0;o<r.length;o++){const l=s+r[o].x,c=a+r[o].y;if(l>=0&&l<n&&c>=0&&c<i){const i=c*n+l;t[i]=e(t[i]+h*(r[o].w/48),0,255)}}}}(i.buf,i.W,i.H);break;case 3:!function(t,e,n){const i=[[0,32,8,40,2,34,10,42],[48,16,56,24,50,18,58,26],[12,44,4,36,14,46,6,38],[60,28,52,20,62,30,54,22],[3,35,11,43,1,33,9,41],[51,19,59,27,49,17,57,25],[15,47,7,39,13,45,5,37],[63,31,55,23,61,29,53,21]];for(let r=0;r<n;r++)for(let n=0;n<e;n++){const a=r*e+n,s=(i[r%8][n%8]+.5)*(255/64);t[a]=t[a]<s?0:255}}(i.buf,i.W,i.H);break;case 4:!function(t,e,n){const i=(t,e,n,i,r)=>0===r?(1===i&&(e=t-1-e,n=t-1-n),[n,e]):[e,n],r=(t,e)=>{let n=0,r=0,a=e;for(let e=1;e<t;e<<=1){const t=1&a>>1,s=1&(a^t);[n,r]=i(e,n,r,t,s),n+=e*t,r+=e*s,a>>=2}return[n,r]},a=new Array(16).fill(0);let s=0;const o=((t,e)=>{let n=1;for(;n<Math.max(t,e);)n<<=1;const i=[];for(let a=0;a<n*n;a++){const[s,o]=r(n,a);s<t&&o<e&&i.push([s,o])}return i})(e,n);for(let n=0;n<o.length;n++){const[i,r]=o[n],l=r*e+i;let c=t[l],h=0,d=1;for(let t=0;t<16;t++)h+=a[(s-t+16)%16]*d,d*=.75;let u=c+h;u<0&&(u=0),u>255&&(u=255);const p=u<128?0:255;t[l]=p;const g=u-p;s=(s+1)%16,a[s]=g}}(i.buf,i.W,i.H)}t.thresh&&B(i.buf,t.thresh),t.median&&function(t,i,r){let a=[[0,0],[0,1],[1,0]],s=[...t];for(let o=0;o<i;o++)for(let l=0;l<r;l++)if(0!=o&&o!=i-1&&0!=l&&l!=r-1){let r=[];for(let t=0;t<a.length;t++)r.push(s[o+a[t][0]+(l+a[t][1])*i]);r.sort();let c=r[r.length-1]-r[0];t[o+l*i]=n(e(c,0,255))}if(S(t),!(r<2||i<2)){for(let e=0;e<i;e++)t[e]=t[e+i],t[e+i*(r-1)]=t[e+i*(r-2)];for(let e=0;e<r;e++)t[e*i]=t[e*i+1],t[e*i+i-1]=t[e*i+i-2]}}(i.buf,i.W,i.H),t.invert&&S(i.buf);for(let t=0,e=0;t<s.length;t+=4,e++)s[t+3]&&(s[t+0]=s[t+1]=s[t+2]=i.buf[e])}i.putImageData(a,0,0)}getData(){let t=this.cv.width,e=this.cv.height;return t&&e?this.cx.getImageData(0,0,t,e).data:null}}function M(t){return(t=t.substring(t.lastIndexOf("/")+1,t.lastIndexOf(".")).replaceAll("-","_").replaceAll(" ","_").substring(0,10)).length?t[0]>="0"&&t[0]<="9"&&(t="b"+t):t="bitmap",t}class C{prefix="const uint8_t";ext="bin";plainText=!1;cv=pt.$cvres;cx=pt.$cvres.getContext("2d",{willReadFrequently:!0});ui=z;img=new w;click(){}convert(t,e,n){this.img.resize(e,n);for(let e=0,n=0;e<t.length;e+=4,n++)t[e+3]&&(this.img.buf[n]=this._encodeColor(t[e],t[e+1],t[e+2]));this.show()}show(){let t=this.filter?this.filter(this.img.copy()):this.img,e=Math.ceil(this.cv.clientWidth/t.W);if(e>1){let n=this.cv.width=e*t.W,i=this.cv.height=e*t.H;this.cx.fillStyle=X.off,this.cx.fillRect(0,0,n,i);for(let n=0,i=0,r=0;n<t.buf.length;n++){let a=t.buf[n];a=this._decodeColor(a),a&&(this.cx.fillStyle=a,this.cx.fillRect(i*e,r*e,e,e)),++i==t.W&&(i=0,++r)}}else{this.cv.width=t.W,this.cv.height=t.H,this.cx.fillStyle=X.off,this.cx.fillRect(0,0,t.W,t.H);let e=this.cx.getImageData(0,0,t.W,t.H),n=e.data;for(let e=0,i=0;e<n.length;e+=4,i++){let r=this._decodeColor(t.buf[i]);if(r){let t=l(parseInt(r.slice(1,7),16));n[e+0]=t[0],n[e+1]=t[1],n[e+2]=t[2],n[e+3]=r.length>7?parseInt(r.slice(7,9),16):255}}this.cx.putImageData(e,0,0)}N.result=""}_encodeColor(t,e,n){return 255-k(t,e,n)}_decodeColor(t){return t?X.on+t.toString(16).padStart(2,0):0}}class L extends C{gray=!0;constructor(){super(),this.ui.addSlider("thresh","Threshold",128,0,256,1,()=>this.show())}filter(t){return B(t.buf,this.ui.thresh),t}click(t,e){this.cv.clientWidth/this.img.W<2||(t=Math.floor(t*this.img.W),e=Math.floor(e*this.img.H),this.img.set(t,e,255-this.img.get(t,e)),this.show())}_decodeColor(t){return t?X.on:0}}class E extends L{static name="8x Horizontal MSB";ext="8h";async encode(){let t=this.img,e=[],n=Math.ceil(t.W/8);for(let i=0;i<t.H;i++)for(let r=0;r<n;r++){let n=0;for(let e=0;e<8;e++)n<<=1,n|=t.get(8*r+e,i)?1:0;e.push(n)}return Uint8Array.from(e)}}class T extends L{static name="8x Vertical Col";ext="8vc";async encode(){return Uint8Array.from(T.make(this.img))}static make(t){let e=[],n=Math.ceil(t.H/8);for(let i=0;i<t.W;i++)for(let r=0;r<n;r++){let n=0;for(let e=0;e<8;e++)n>>=1,n|=(t.get(i,8*r+e)?1:0)<<7;e.push(n)}return e}}class W extends L{static name="GyverGFX BitMap";ext="map";prefix="gfxmap_t";async encode(){return Uint8Array.from(W.make(this.img))}static make(t){return[255&t.W,t.W>>8&255,255&t.H,t.H>>8&255].concat(T.make(t))}}class R extends L{static name="GyverGFX BitPack";ext="pack";prefix="gfxpack_t";async encode(){return Uint8Array.from(R.make(this.img))}static make(t){let e=[255&t.W,t.W>>8&255,255&t.H,t.H>>8&255],n=0,i=0,r=0,a=()=>{let t=n<<1|i;switch(3&r++){case 0:e.push(t<<2);break;case 1:e[e.length-1]|=t>>4,e.push(t<<4&240);break;case 2:e[e.length-1]|=t>>2,e.push(t<<6&192);break;case 3:e[e.length-1]|=t}};for(let e=0;e<t.W;e++)for(let r=0;r<t.H;r++){let s=t.get(e,r)?1:0;n?i==s?(n++,31==n&&(a(),n=0)):(a(),i=s,n=1):(n=1,i=s)}return n&&a(),e}}class H extends C{static name="RGB24";prefix="const uint32_t";ext="rgb24";async encode(){return Uint32Array.from(this.img.buf)}_encodeColor(t,e,n){return o(t,e,n)}_decodeColor(t){return s(t)}}let A;function G(t){z.removeAll(),A=new U[t],N.getWidget("save").label="Save ."+A.ext,tt()}let O,D,z,N,j,F,P,U=[class extends L{static name="1 pix/byte";ext="1p";async encode(){return Uint8Array.from(this.img.buf.map(t=>t?1:0))}},E,class extends E{static name="8x Horizontal LSB";async encode(){return(await super.encode()).map(function(t){return t=(170&(t=(204&(t=(240&t)>>4|(15&t)<<4))>>2|(51&t)<<2))>>1|(85&t)<<1})}},T,class extends L{static name="8x Vertical Row";ext="8vr";async encode(){let t=this.img,e=[],n=Math.ceil(t.H/8);for(let i=0;i<n;i++)for(let n=0;n<t.W;n++){let r=0;for(let e=0;e<8;e++)r>>=1,r|=(t.get(n,8*i+e)?1:0)<<7;e.push(r)}return Uint8Array.from(e)}},class extends L{static name="GyverGFX Image";ext="img";prefix="gfximage_t";async encode(){let t=this.img,e=Math.ceil(t.H/8)*t.W+4,n=R.make(t);return Uint8Array.from(e<=n.length?[0].concat(W.make(t)):[1].concat(n))}},W,R,class extends C{static name="Grayscale";ext="gray";gray=!0;async encode(){return Uint8Array.from(this.img.buf)}},H,class extends H{static name="RGB888";ext="rgb888";async encode(){let t=[];return this.img.buf.forEach(e=>t.push(...l(e))),Uint8Array.from(t)}},class extends C{static name="RGB565";prefix="const uint16_t";ext="rgb565";async encode(){return Uint16Array.from(this.img.buf)}_encodeColor(t,e,n){return((t,e,n)=>(248&t)<<8|(252&e)<<3|n>>3)(t,e,n)}_decodeColor(t){return s((63488&t)<<8|(2016&t)<<5|(31&t)<<3)}},class extends C{static name="RGB233";ext="rgb233";async encode(){return Uint8Array.from(this.img.buf)}_encodeColor(t,e,n){return((t,e,n)=>192&t|(224&e)>>2|(224&n)>>5)(t,e,n)}_decodeColor(t){return s((192&t)<<16|(56&t)<<10|(7&t)<<5)}},class extends C{static name="ASCII";prefix="const char";ext="txt";gray=!0;plainText=!0;pallette=["Wwli:,. ","@%#*+=-:. ","@B%8&WM#*oahkbdpqwmZO0QLCJUYXzcvunxrjft/|()1{}[]?-_+~<>i!lI;:,\"^`'. ","█▓▒░ "];constructor(){super(),this.ui.addSelect("res","Resolution",["8 char","10 char","70 char","5 gray"],()=>this.show()).addSwitch("half","Half",!0,()=>this.show())}show(){let t=this.cv,e=this.cx,i=t.getBoundingClientRect(),r=i.width,a=i.height;t.width=r,t.height=a,e.fillStyle=X.off,e.fillRect(0,0,r,a);let s=this.getText().split("\n"),o=a;e.font=o+"px monospace";let l=e.measureText(s[0]);l=[l.width,o*s.length*1.3];let c=Math.min(r/l[0],a/l[1]);o=n(o*c),e.font=o+"px monospace",e.textAlign="center",e.textBaseline="top",e.fillStyle=X.on;let h=0;for(const t of s)e.fillText(t,r/2,h),h+=1.3*o}getText(){let t=this.pallette[this.ui.res],e=t.length,n=this.ui.half,i="";for(let r=0;r<this.img.H;r++){for(let a=0;a<this.img.W;a++){let s=this.img.buf[r*this.img.W+a];n&&r<this.img.H-1&&(s=(s+this.img.buf[(r+1)*this.img.W+a])/2),i+=t[(255-s)*(e-1)/255|0]}n&&r++,r<this.img.H-1&&(i+="\n")}return i}async encode(){return r(this.getText())}}],X={},Y=null;function q(t){t?document.body.classList.add("darkmode"):document.body.classList.remove("darkmode");let e=t?"dark":"light";O.setTheme(e),N.setTheme(e),z.setTheme(e),D.setTheme(e),X={off:t?"#1e232a":"#fff",on:t?"#478be6":"#000000"}}function J(){O=new _({parent:pt.$ui_in,width:"unset"}).addFile("file","File",K).addInput("link","Link","",K).addButton("paste","Paste",V).addButton("fil_png","Save .png",ht).addSpace().addNumber("width","Width",128,1,et).addNumber("height","Height",64,1,et).addButton("fit","Fit",()=>j.fit()).addRange("angle","Rotate",0,-180,180,5,tt).addSpace().addSwitch("bblack","Black Background",!1,tt).addRange("brightness","Brightness",100,0,300,5,tt).addRange("contrast","Contrast",100,0,300,5,tt).addRange("saturate","Saturation",100,0,300,5,tt).addRange("blur","Blur",0,0,1,.05,tt).addSpace().addSwitch("mask","Mask",!1,tt).addColor("mask_color","Color","#000000",tt).addRange("mask_tol","Tolerance",0,0,400,1,tt).addRange("mask_amp","Amplify",1,1,10,.5,tt).addSpace().addSwitch("gray","Gray Filters",!1,tt).addSwitch("edges","Edges Simple",0,tt).addRange("sobel","Edges Sobel",0,0,1,.05,tt).addSelect("dither","Dithering",["None","Floyd-Steinberg","JJN","Bayer","Riemersma"],tt).addSlider("thresh","Threshold",0,0,255,1,tt).addSwitch("median","Edges Median",0,tt).addSwitch("invert","Invert",0,tt).addSpace().addButton("reset","Reset",Z),D=new _({parent:pt.$ui_out,width:"unset"}).addSelect("conv","Converter",U.map(t=>t.name),G),z=new _({parent:pt.$ui_out,width:"unset"});let t={save:["save",at]};window.location.hostname.match(/^((25[0-5]|(2[0-4]|1[0-9]|[1-9]|)[0-9])(\.(?!$)|$)){4}$/)&&(t.send=["Send",st]),N=new _({parent:pt.$ui_out,width:"unset"}).addInput("name","Name","none").addSwitch("pgm","PROGMEM",!0).addButton("encode","Encode",nt).addHTML("result","","").addButtons({copy:["Copy",it],header:["Save .h",rt]}).addButtons(t).addButton("proc_png","Save .png",dt),j=new I(pt.$cvimg,tt),d.init("darkmode",!1),P=d.get("darkmode"),q(P),G(0),et(),new $(pt.$cvres,t=>{"click"==t.type&&A.click(t.pos.x/t.width,t.pos.y/t.height)})}async function V(){let t=await navigator.clipboard.read();for(const e of t)for(const t of e.types)if(t.startsWith("image/")){const n=await e.getType(t);return void Q(new File([n],"pasted",{type:n.type}))}}function K(t){t instanceof FileList?(Y=t,Q(Y[0])):(O.link="",Y=null,Q(t))}async function Q(t,e=!0){try{let n=await async function(t){return new Promise((e,n)=>{let i,r=new Image;switch(r.crossOrigin="Anonymous",r.addEventListener("load",()=>{r.width&&r.height?e({image:r,name:i}):n("Image error")}),r.addEventListener("error",()=>{n("Image load error")}),typeof t){case"object":t.type.toString().includes("image")||n("Not an image"),r.src=URL.createObjectURL(t),i=M(t.name);break;case"string":t.startsWith("http")||n("Not a link"),r.src=t,i=M(t);break;default:n("Image error")}})}(t);j.setImage(n.image,e),e&&(N.name=n.name,j.fit()),tt()}catch(t){alert(t)}}function Z(){["bblack","brightness","contrast","saturate","blur","mask","mask_color","mask_tol","mask_amp","gray","edges","sobel","dither","thresh","median","invert"].forEach(t=>O.getWidget(t).default()),tt()}function tt(){j.setFilter(O.toObject()),j.show();let t=j.getData();t&&A.convert(t,j.cv.width,j.cv.height)}function et(){let t=O.width,e=O.height;document.body.style.setProperty("--ratio",t/e),j.cv.width=t,j.cv.height=e,tt()}async function nt(){if(Y){F=[];for(let t of Y)await Q(t,!1),F.push(await A.encode());let t=0;F.forEach(e=>t+=e.byteLength),N.result=`Done! ${F.length} images, ${t} bytes`}else F=await A.encode(),N.result=`Done! ${F.byteLength} bytes`}function it(){F&&(A.plainText?i(a(F)):i(lt()))}function rt(){F&&c(new Blob([r(lt())],{type:"text/plain"}),N.name+".h")}function at(){F&&c(new Blob([F],{type:"application/octet-stream"}),N.name+"."+A.ext)}async function st(){if(!F)return;let t=new FormData;t.append("bitmap",new Blob([F],{type:"application/octet-stream"}));let e=await h(window.location.href+`bitmap?width=${A.img.W}&height=${A.img.H}&type=${A.ext}`,{method:"POST",body:t,timeout:2e3});alert(e?"Sent":"Send error")}function ot(t,e){let n=2*t.BYTES_PER_ELEMENT,i=N.pgm?"PROGMEM ":"";8==n&&(n=6);let r=`${A.prefix} ${e}[] ${i}= {`;for(let e=0;e<t.length;e++)e%24==0&&(r+="\n\t"),r+="0x"+t[e].toString(16).padStart(n,0),e!=t.length-1&&(r+=", ");return r+="\n};",r}function lt(){let t=N.name,e="",n=N.pgm?"PROGMEM ":"";const i=(e,n,i)=>`#pragma once\n#include <Arduino.h>\n\n// ${t}, ${n}x${i}, ${e}\n// Bitmaper v2 [${U[D.conv].name}]\n\nconst uint16_t ${t}_w = ${n};\nconst uint16_t ${t}_h = ${i};\n\n`;if(A.plainText){let e=A.img.W,r=a(F).split("\n"),s=r.length,o=i(`${F.byteLength} bytes`,e,s);return o+=`${A.prefix} ${t}[] ${n}=\n`,o+=r.map(t=>`\t"${t.replace(/"/g,'\\"')}\\n"`).join("\n"),o=o.slice(0,-3),o+='";',o}if(Array.isArray(F)){let r=0;F.forEach(t=>r+=t.byteLength),e+=i(`${F.length} images, ${r} bytes`,A.img.W,A.img.H);let a="";for(let n in F){let i=t+"_"+n;e+=ot(F[n],i)+"\n\n",0!=n&&(a+=", ",n%8==0&&(a+="\n\t")),a+=i}e+=`const uint16_t ${t}_list_size = ${F.length};\n\n`,e+=`${A.prefix}* const ${t}_list_pgm[] ${n}= {\n\t${a}\n};\n\n`,e+=`${A.prefix}* const ${t}_list[] = {\n\t${a}\n};`}else e+=i(`${F.byteLength} bytes`,A.img.W,A.img.H),e+=ot(F,t);return e}function ct(t,e){let n=document.createElement("a");n.href=t.toDataURL("image/png"),n.download=e+".png",n.click()}function ht(){ct(j.cv,N.name+".filt")}function dt(){ct(A.cv,N.name+".proc")}const ut=function t(e,n=0){if(n>10)return e;const i=[];return function(t){const e=t.split("\n");let n="",i=[];for(let t of e){const e=/^(\s*)([-]|\d+\.)\s+(.*)$/.exec(t);if(e){const t=e[1].length,r=e[2].match(/^\d/)?"ol":"ul",a=e[3],s=Math.floor(t/2);if(!i.length){n+=`<${r}><li>${a}`,i.push({type:r,level:s});continue}const o=i[i.length-1];if(s>o.level)n+=`<${r}><li>${a}`,i.push({type:r,level:s});else if(s===o.level)n+=`</li><li>${a}`;else{for(;i.length&&i[i.length-1].level>=s;)n+=`</li></${i.pop().type}>`;i.length&&i[i.length-1].type===r?n+=`<li>${a}`:(n+=`<${r}><li>${a}`,i.push({type:r,level:s}))}}else{for(;i.length;)n+=`</li></${i.pop().type}>`;n+=t+"\n"}}for(;i.length;)n+=`</li></${i.pop().type}>`;return n}(e=e.replace(/```([\s\S]*?)```/g,(t,e)=>{const n=i.length;return i.push(`<pre><code>${e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[t]))}</code></pre>`),`§CODEBLOCK${n}§`})).replace(/^---$/gm,"<hr>").replace(/!\[([^\]]*)\]\(([^)]+)\)/g,'<img src="$2" alt="$1">').replace(/^###### (.*)$/gm,"<h6>$1</h6>").replace(/^##### (.*)$/gm,"<h5>$1</h5>").replace(/^#### (.*)$/gm,"<h4>$1</h4>").replace(/^### (.*)$/gm,"<h3>$1</h3>").replace(/^## (.*)$/gm,"<h2>$1</h2>").replace(/^# (.*)$/gm,"<h1>$1</h1>").replace(/(^>.*(?:\n>.*)*)/gm,e=>`<blockquote>${t(e.split("\n").map(t=>t.replace(/^>\s?/,"")).join("\n"),n+1)}</blockquote>`).replace(/\[spoiler="([^"]+)"\]([\s\S]*?)\[\/spoiler\]/g,(e,i,r)=>`<details><summary>${i}</summary>${t(r,n+1)}</details>`).replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2">$1</a>').replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/(^|[\s>])\*([^*\s][^*]*?)\*(?=[\s<]|$)/g,"$1<em>$2</em>").replace(/^(?!<h\d|<ul|<ol|<pre|<p|<blockquote|<code|<hr|<img|<details|<summary)(.+)$/gm,"<p>$1</p>").replace(/§CODEBLOCK(\d+)§/g,(t,e)=>i[e])}('Bitmaper - программа для преобразования изображений в бинарный вид для вывода на дисплей и трассировки на ЧПУ\n\n## Основные возможности\n- Загрузка картинки файлом, по ссылке или из буфера обмена\n- Поддержка перемещения и масштаба с тачскрина\n- Поддержка пакетной обработки (только для файлов)\n- Встроенный редактор: изменение размера, обрезка, поворот, набор фильтров\n- Несколько алгоритмов кодирования\n- Вывод в буфер обмена, в файл .h, в бинарный файл или отправка на HTTP сервер\n\n### Последовательность работы\n1. Загрузить изображение файлом (можно перетащить в поле), по ссылке или вставить из буфера\n2. Настроить размер, позицию кадра (перемещение курсором, масштаб щипком или колесом мыши), фильтры\n3. Выбрать режим кодирования\n4. Нажать **Encode**\n5. Забрать результат, нажав на нужную кнопку (копировать, сохранить как .h файл итд)\n\n### Массовая конвертация\n- Для пакетной обработки нужно выбрать или перетащить несколько файлов в поле выбора файла, на превью отобразится первый файл\n- При нажатии на **Encode** все файлы обработаются по порядку с настройками первого файла (позиция, фильтры итд)\n- Результат будет доступен только в текстовом виде (копировать или .h файл), в нём будут все изображения и список указателей\n\n## Обработка\n### Редактор\nВ моно режимах клик по превью (нижнее окно) инвертирует пиксель под курсором.\n\n### Фильтры\n- **Black Background**: подкладывает чёрный фон под исходное изображение (нужно если оно имеет тёмный фон)\n- **Brightness, Contrast, Saturation**: яркость, контраст, насыщенность\n- **Blur**: размытие\n- **Mask**: выделение цвета на изображении, результат - маска в градациях серого\n  - **Color**: целевой цвет. На десктопной версии можно выбрать "пипеткой" по превью. Чтобы использовать пипетку при активном фильтре, нужно сначала отключить фильтр, чтобы изображение обратно стало цветным\n  - **Tolerance**: допуск цвета. Чем больше - тем менее похожие цвета попадут в маску\n  - **Amplify**: усиление маски (делает результат более ярким)\n- **Gray Filters**: блок серых фильтров, при активации изображение переводится в градации серого\n  - **Edges Simple**: простое усиление краёв\n  - **Edges Sobel**: выделение краёв по алгоритму Sobel\n  - **Dithering**: dithering\n  - **Threshold**: перевод в ч/б с заданным порогом\n  - **Edges Median**: выделение краёв (ширина 1 пиксель)\n  - **Invert**: инвертирование\n\n### Алгоритмы кодирования\n\n- **1 pix/byte**: моно, 1 пиксель в байте, строками слева направо сверху вниз, [p0, ...pn]\n- **8x Horizontal MSB**: моно, 8 пикселей в байте горизонтально (MSB слева), строками слева направо сверху вниз, [p0, ...pn]\n- **8x Horizontal LSB**: моно, 8 пикселей в байте горизонтально (LSB слева), строками слева направо сверху вниз, [p0, ...pn]. **Подходит для u8glib**\n- **8x Vertical Col**: моно, 8 пикселей в байте вертикально (MSB снизу), столбцами сверху вниз слева направо, [p0, ...pn]\n- **8x Vertical Row**: моно, 8 пикселей в байте вертикально (MSB снизу), строками слева направо сверху вниз, [p0, ...pn]. **Подходит для GyverOLED**\n- **GyverGFX Image**: программа выберет лёгкий между BitMap и BitPack, [0 map | 1 pack, x, x, x, x, p0, ...pn]\n- **GyverGFX BitMap**: моно, 8 пикселей вертикально (MSB снизу), столбцами сверху вниз слева направо, [widthLSB, widthMSB, heightLSB, heightMSB, p0, ...pn]\n- **GyverGFX BitPack**: моно, сжатый RLE формат, [widthLSB, widthMSB, heightLSB, heightMSB, p0, ...pn]\n- **Grayscale**: оттенки серого, 1 пиксель в байте, [p0, ...pn]\n- **RGB24**: цветной, 1 пиксель на 4 байта, [p0, ...pn], тип uint32_t\n- **RGB888**: цветной, 1 пиксель на 3 байта (24 бит RGB) [r0, g0, b0, ...]\n- **RGB565**: цветной, 1 пиксель на 2 байта (16 бит RGB) [rrrrrggggggbbbbb, ...] тип uint16_t\n- **RGB233**: цветной, 1 пиксель в байте (8 бит RGB) [rrgggbbb, ...]\n- **ASCII**: кодирование символами\n');let pt={};function gt(){t.configIn(pt,document.body,{children:[{tag:"header",children:[{class:"bt_btns",children:[{class:"bt_btn icon bars",click:()=>{pt.$ui_in.classList.toggle("ui_hidden"),pt.$ui_out.classList.add("ui_hidden")}},{class:"bt_btn icon code",click:()=>{pt.$ui_in.classList.add("ui_hidden"),pt.$ui_out.classList.toggle("ui_hidden")}},{class:"icon info",click:()=>{pt.$help.classList.toggle("hidden")}}]},{text:"Bitmaper v2"},{style:"display:flex",child:{class:"icon moon",click:t=>(P=!P,q(P),d.set("darkmode",P),void tt())}}]},{tag:"main",children:[{class:"ui_in",$:"ui_in"},{class:"ui_out ui_hidden",$:"ui_out"},{class:"cv_col",children:[{tag:"canvas",$:"cvimg"},{tag:"canvas",$:"cvres"}]}]},{class:"help_overlay hidden",$:"help",click:t=>{pt.$help.classList.toggle("hidden")},child:{class:"help_cont",children:[{html:ut}]}}]})}document.addEventListener("DOMContentLoaded",()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js"),gt(),J()})})();